import{r,h as L,a as C,j as t,L as j,i as x}from"./index-BhxEaC_k.js";import{Q as E,B as y}from"./ReactToastify-BodD9Uj_.js";const P="_container_1rfw7_1",T="_heading_1rfw7_11",D="_form_1rfw7_17",I="_input_1rfw7_22",O="_button_1rfw7_35",M="_links_1rfw7_56",q="_error_1rfw7_70",B="_success_1rfw7_76",e={container:P,heading:T,form:D,input:I,button:O,links:M,error:q,success:B},z=()=>{const[i,S]=r.useState(""),[c,b]=r.useState(""),[u,d]=r.useState(!1),[p,s]=r.useState(""),g=L(),m=C(),N=async o=>{var f,h;if(o.preventDefault(),!i||!c){s("Please fill out both fields for login.");return}d(!0),s("");try{const l=await fetch("https://shopplus-ecom.onrender.com/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,password:c})}),a=await l.json();if(l.ok){console.log("Login successful:",a.user._id),localStorage.setItem("authToken",a.token),localStorage.setItem("userId",a.user._id);const n=await fetch("https://shopplus-ecom.onrender.com/cart",{headers:{Authorization:`Bearer ${a.token}`}});if(n.ok){const w=((h=(f=(await n.json()).cart)==null?void 0:f.items)==null?void 0:h.reduce((k,v)=>k+v.quantity,0))||0;localStorage.setItem("cartCount",w),m(x(w)),y.success("Successfully logged in!",{position:"top-center",autoClose:1e3}),setTimeout(()=>g("/products"),2e3)}else if(n.status===404)localStorage.setItem("cartCount",0),m(x(0)),y.success("Successfully logged in! No cart found.",{position:"top-center",autoClose:1e3}),setTimeout(()=>g("/products"),2e3);else{const _=await n.json();s(_.message||"Failed to fetch cart information.")}}else s(a.message||"Login failed.")}catch{s("Something went wrong. Please try again.")}finally{d(!1)}};return t.jsxs("div",{className:e.container,children:[t.jsx("h2",{className:e.heading,children:"Login"}),t.jsxs("form",{onSubmit:N,className:e.form,children:[t.jsx("input",{className:e.input,type:"text",placeholder:"Email or Mobile Number",value:i,onChange:o=>S(o.target.value)}),t.jsx("input",{className:e.input,type:"password",placeholder:"Password",value:c,onChange:o=>b(o.target.value)}),t.jsx("button",{className:e.button,type:"submit",disabled:u,children:u?"Logging in...":"Login"})]}),t.jsxs("div",{className:e.links,children:[t.jsx(j,{to:"/signup",children:"Don't have an account? Sign Up"}),t.jsx(j,{to:"/forgot-password",children:"Forgot Password?"})]}),p&&t.jsx("p",{className:e.error,children:p}),t.jsx(E,{})]})};export{z as default};
