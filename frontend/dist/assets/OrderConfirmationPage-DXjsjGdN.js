import{a as _,r as d,h as j,m as f,j as e}from"./index-BhxEaC_k.js";const g="_orderConfirmationContainer_1jch2_1",I="_confirmationTitle_1jch2_10",y="_confirmationMessage_1jch2_17",C="_orderSummary_1jch2_22",x="_orderItemsList_1jch2_35",S="_orderItem_1jch2_35",v="_itemDetails_1jch2_45",N="_itemName_1jch2_50",T="_itemQuantity_1jch2_55",k="_itemPrice_1jch2_55",D="_total_1jch2_60",O="_shippingInfo_1jch2_68",P="_homeButton_1jch2_86",E="_loadingContainer_1jch2_106",b="_loader_1jch2_111",q="_spin_1jch2_1",n={orderConfirmationContainer:g,confirmationTitle:I,confirmationMessage:y,orderSummary:C,orderItemsList:x,orderItem:S,itemDetails:v,itemName:N,itemQuantity:T,itemPrice:k,total:D,shippingInfo:O,homeButton:P,loadingContainer:E,loader:b,spin:q},L=()=>{const l=_(),[a,m]=d.useState({items:[],total:0,shippingAddress:""}),i=j();d.useEffect(()=>{const t=JSON.parse(localStorage.getItem("orderData"));if(t){const o=h(t.items);m({...t,total:o}),localStorage.removeItem("cart"),localStorage.removeItem("cartCount"),u(t)}else i("/")},[i]);const h=t=>t.reduce((o,s)=>o+(s.productId.price||0)*(s.quantity||0),0),u=async t=>{try{const o=localStorage.getItem("authToken"),s=localStorage.getItem("userId");if(!o){i("/login");return}const c=await fetch("https://shopplus-ecom-backend.onrender.com/order-confirmation",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({userId:s,items:t.items.map(r=>({productId:r.productId._id||r.productId,quantity:r.quantity,amount:r.productId.price*r.quantity}))})}),p=await c.json();c.ok?(await fetch("https://shopplus-ecom-backend.onrender.com/cart/clear",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}})).ok?(console.log("Cart removed successfully from backend"),localStorage.removeItem("cart"),localStorage.removeItem("cartCount"),l(f())):console.error("Failed to clear cart on the backend"):console.error("Failed to create order:",p.message)}catch(o){console.error("Error creating order:",o)}};return!a||!a.items.length?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:n.orderConfirmationContainer,children:[e.jsx("h1",{className:n.confirmationTitle,children:"Order Confirmation"}),e.jsxs("div",{className:n.confirmationMessage,children:[e.jsx("h2",{children:"Thank you for your order!"}),e.jsx("p",{children:"Your order has been successfully placed."})]}),e.jsxs("div",{className:n.orderSummary,children:[e.jsx("h3",{children:"Order Details"}),e.jsx("ul",{children:a.items.map((t,o)=>e.jsxs("li",{className:n.orderItem,children:[e.jsxs("p",{children:["Product: ",t.productId.name||"Unknown Item"]}),e.jsxs("p",{children:["Quantity: ",t.quantity||0]}),e.jsxs("p",{children:["Price: $",t.productId.price?t.productId.price.toFixed(2):"0.00"]})]},o))}),e.jsx("div",{className:n.total,children:e.jsxs("strong",{children:["Total Amount Paid: $",a.total?a.total.toFixed(2):"0.00"]})})]})]})};export{L as default};
