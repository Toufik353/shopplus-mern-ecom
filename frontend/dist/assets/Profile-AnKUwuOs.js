import{r as o,j as e}from"./index-BhxEaC_k.js";import{Q as q,B as i}from"./ReactToastify-BodD9Uj_.js";const w="_container_1rfr9_1",O="_header_1rfr9_15",L="_profileInfo_1rfr9_22",$="_form_1rfr9_22",M="_addressSection_1rfr9_22",H="_addAddressButton_1rfr9_26",z="_modalOverlay_1rfr9_40",U="_modal_1rfr9_40",J="_subHeader_1rfr9_61",K="_editButton_1rfr9_78",R="_formGroup_1rfr9_98",Q="_input_1rfr9_110",V="_buttonGroup_1rfr9_118",W="_button_1rfr9_118",X="_cancelButton_1rfr9_123",Y="_modalContent_1rfr9_150",Z="_addressItem_1rfr9_160",s={container:w,header:O,profileInfo:L,form:$,addressSection:M,addAddressButton:H,modalOverlay:z,modal:U,subHeader:J,editButton:K,formGroup:R,input:Q,buttonGroup:V,button:W,cancelButton:X,modalContent:Y,addressItem:Z},ae=()=>{const[d,h]=o.useState(null),[f,x]=o.useState([]),[j,b]=o.useState(!1),[_,c]=o.useState(!1),[C,k]=o.useState(!0),[A,N]=o.useState(!0),[l,g]=o.useState({name:"",email:"",mobile:""}),S=async()=>{const t=localStorage.getItem("authToken");try{const r=await fetch("https://shopplus-ecom-backend.onrender.com/profile",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(r.ok){const a=await r.json();h(a),g({name:a.name||"",email:a.email||"",mobile:a.mobile||""})}else console.error("Failed to fetch user data")}catch(r){console.error("Error fetching user data:",r)}finally{k(!1)}},y=async()=>{const t=localStorage.getItem("authToken");N(!0);try{const r=await fetch("https://shopplus-ecom-backend.onrender.com/addaddress",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(r.ok){const a=await r.json();x(a),localStorage.setItem("address",a)}else console.error("Failed to fetch addresses")}catch(r){console.error("Error fetching address data:",r)}finally{N(!1)}};o.useEffect(()=>{S(),y()},[]);const v=()=>{b(!j)},u=t=>{g({...l,[t.target.name]:t.target.value})},G=async t=>{t.preventDefault();const r=localStorage.getItem("authToken");try{(await fetch("https://shopplus-ecom-backend.onrender.com/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(l)})).ok?(i.success("Profile updated successfully!",{position:"top-center"}),h(l),b(!1)):oast.success("Failed to update profile",{position:"top-center"})}catch(a){console.error("Error updating profile:",a)}},B=async t=>{const r=localStorage.getItem("authToken");try{const a=await fetch("https://shopplus-ecom-backend.onrender.com/addaddress",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(t)});if(a.ok){const m=await a.json();x(n=>[...n,m]),c(!1),y(),i.success("Address added successfully!",{position:"top-center"})}else console.error("Failed to add address"),i.error("Failed to add address. Please check your input and try again.",{position:"top-center"})}catch(a){console.error("Error adding address:",a),i.error("An error occurred. Please try again.",{position:"top-center"})}},I=({onAddressAdd:t,onClose:r})=>{const[a,m]=o.useState({country:"India",fullName:"",mobile:"",pincode:"",flat:"",area:"",landmark:"",city:"",state:"",isDefault:!1}),n=p=>{const{name:D,value:E,type:T,checked:F}=p.target;m({...a,[D]:T==="checkbox"?F:E})},P=p=>{if(p.preventDefault(),!a.fullName||!a.mobile||!a.pincode||!a.flat||!a.city||!a.state){i.error("Please fill out all required fields.",{position:"top-center"});return}t(a)};return e.jsxs("div",{className:s.modalContent,children:[e.jsx("h2",{children:"Add New Address"}),e.jsxs("form",{onSubmit:P,className:s.addressForm,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Country/Region"}),e.jsx("select",{name:"country",value:a.country,onChange:n,className:s.input,children:e.jsx("option",{value:"India",children:"India"})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Full Name"}),e.jsx("input",{type:"text",name:"fullName",value:a.fullName,onChange:n,className:s.input,placeholder:"First and Last Name",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Mobile Number"}),e.jsx("input",{type:"tel",name:"mobile",value:a.mobile,onChange:n,className:s.input,placeholder:"10-digit mobile number",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Pincode"}),e.jsx("input",{type:"text",name:"pincode",value:a.pincode,onChange:n,className:s.input,placeholder:"6 digits [0-9]",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Flat, House no., Building, Company, Apartment"}),e.jsx("input",{type:"text",name:"flat",value:a.flat,onChange:n,className:s.input,required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Area, Street, Sector, Village"}),e.jsx("input",{type:"text",name:"area",value:a.area,onChange:n,className:s.input})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Landmark"}),e.jsx("input",{type:"text",name:"landmark",value:a.landmark,onChange:n,className:s.input,placeholder:"E.g. near Apollo Hospital"})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Town/City"}),e.jsx("input",{type:"text",name:"city",value:a.city,onChange:n,className:s.input,required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"State"}),e.jsxs("select",{name:"state",value:a.state,onChange:n,className:s.input,required:!0,children:[e.jsx("option",{value:"",children:"Choose a state"}),e.jsx("option",{value:"Maharashtra",children:"Maharashtra"}),e.jsx("option",{value:"Karnataka",children:"Karnataka"}),e.jsx("option",{value:"Tamil Nadu",children:"Tamil Nadu"})]})]}),e.jsx("div",{className:s.formGroup,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"isDefault",checked:a.isDefault,onChange:n})," ","Make this my default address"]})}),e.jsxs("div",{className:s.buttonGroup,children:[e.jsx("button",{type:"submit",className:s.button,children:"Save Address"}),e.jsx("button",{type:"button",className:s.cancelButton,onClick:r,children:"Cancel"})]})]})]})};return C?e.jsx("div",{className:`${s.container} ${s.loading}`,children:e.jsx("p",{children:"Loading profile..."})}):d?e.jsx("div",{className:s.wrapper,children:e.jsxs("div",{className:s.container,children:[e.jsx("h2",{className:s.header,children:"User Profile"}),j?e.jsxs("form",{onSubmit:G,className:s.form,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Name"}),e.jsx("input",{type:"text",name:"name",value:l.name,onChange:u,className:s.input,required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",name:"email",value:l.email,onChange:u,className:s.input,required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{children:"Mobile"}),e.jsx("input",{type:"tel",name:"mobile",value:l.mobile,onChange:u,className:s.input,required:!0})]}),e.jsxs("div",{className:s.buttonGroup,children:[e.jsx("button",{type:"submit",className:s.button,children:"Save Changes"}),e.jsx("button",{type:"button",className:s.cancelButton,onClick:v,children:"Cancel"})]})]}):e.jsxs("div",{className:s.profileInfo,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",d.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",d.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact:"})," ",d.mobile]}),e.jsx("button",{className:s.editButton,onClick:v,children:"Edit Profile"})]}),e.jsx("h3",{className:s.subHeader,children:"Addresses"}),e.jsx("div",{className:s.addressSection,children:A?e.jsx("p",{children:"Loading addresses..."}):f.length>0?f.map((t,r)=>e.jsxs("div",{className:s.addressItem,children:[e.jsx("p",{children:e.jsx("strong",{children:t.fullName})}),e.jsxs("p",{children:[t.flat,", ",t.area,", ",t.city," - ",t.pincode]}),e.jsxs("p",{children:[t.state,", ",t.country]}),t.landmark&&e.jsxs("p",{children:["Landmark: ",t.landmark]}),t.isDefault&&e.jsx("p",{children:e.jsx("strong",{children:"Default Address"})})]},r)):e.jsx("p",{children:"No addresses available."})}),e.jsx("button",{className:s.addAddressButton,onClick:()=>c(!0),children:"Add Address"}),_&&e.jsx("div",{className:s.modalOverlay,children:e.jsx("div",{className:s.modal,children:e.jsx(I,{onAddressAdd:B,onClose:()=>c(!1)})})}),e.jsx(q,{})]})}):e.jsx("div",{className:`${s.container} ${s.loading}`,children:e.jsx("p",{children:"No user data available."})})};export{ae as default};
