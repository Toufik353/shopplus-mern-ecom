import{r as a,u as L,a as P,j as e,L as b,F as A,b as v,i as R,c as $,d as D,e as O}from"./index-BhxEaC_k.js";import{Q as z,B as c}from"./ReactToastify-BodD9Uj_.js";const H="_container_l91mk_11",M="_filterBar_l91mk_22",J="_searchInput_l91mk_33",q="_categoryFilter_l91mk_44",Q="_categoryButton_l91mk_51",G="_selected_l91mk_72",K="_productList_l91mk_97",U="_productCard_l91mk_105",V="_imageWrapper_l91mk_121",X="_productImage_l91mk_127",Y="_productInfo_l91mk_133",Z="_productName_l91mk_139",tt="_productDescription_l91mk_145",et="_productPrice_l91mk_151",st="_addToCartBtn_l91mk_158",ot="_addToWishlistBtn_l91mk_172",rt="_noResults_l91mk_196",nt="_wishlist_l91mk_202",at="_wishlistContainer_l91mk_209",ct="_wishlistItem_l91mk_215",it="_removeButton_l91mk_261",lt="_emptyWishlistMessage_l91mk_270",dt="_authPrompt_l91mk_276",r={container:H,filterBar:M,searchInput:J,categoryFilter:q,categoryButton:Q,selected:G,productList:K,productCard:U,imageWrapper:V,productImage:X,productInfo:Y,productName:Z,productDescription:tt,productPrice:et,addToCartBtn:st,addToWishlistBtn:ot,noResults:rt,wishlist:nt,wishlistContainer:at,wishlistItem:ct,removeButton:it,emptyWishlistMessage:lt,authPrompt:dt};function _t(){const[l,g]=a.useState([]),[k,w]=a.useState(!0),[d,x]=a.useState(null),[h,u]=a.useState([]),[j,ht]=a.useState(""),[i,C]=a.useState([]),{searchTerm:y}=L(),S=P();a.useEffect(()=>{(async()=>{const o=localStorage.getItem("authToken");try{const s=await fetch("https://shopplus-ecom-backend.onrender.com/products",{headers:{Authorization:`Bearer ${o}`}});if(!s.ok)throw new Error("Failed to fetch products.");const n=await s.json();g(n.products||[])}catch(s){x(s.message)}finally{w(!1)}})()},[]),a.useEffect(()=>{(async()=>{const o=localStorage.getItem("authToken");try{const n=await(await fetch("https://shopplus-ecom-backend.onrender.com/wishlist",{headers:{Authorization:`Bearer ${o}`}})).json();u(n.wishlist||[])}catch(s){console.error("Error fetching wishlist:",s)}})()},[]);const B=async t=>{const o=localStorage.getItem("authToken"),s=localStorage.getItem("userId"),n=1;try{if(!(await fetch("https://shopplus-ecom-backend.onrender.com/cart",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({userId:s,productId:t,quantity:n})})).ok)throw new Error("Failed to add product to cart");S(R(1)),c.success("Successfully added to the cart!",{position:"top-center",autoClose:2e3})}catch{c.error("Error adding to cart",{position:"top-center"})}},N=async t=>{const o=localStorage.getItem("authToken"),s=localStorage.getItem("userId");if(!o){c.error("Login to add the item to the wishlist.",{position:"top-center"});return}try{const n=h.includes(t),_=await fetch(n?"https://shopplus-ecom-backend.onrender.com/wishlist/remove":"hhttps://shopplus-ecom-backend.onrender.com/wishlist/",{method:n?"DELETE":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({userId:s,productId:t})}),W=await _.json();_.ok?(u(f=>n?f.filter(F=>F!==t):[...f,t]),c.success(n?"Removed from wishlist!":"Added to wishlist!",{position:"top-center"})):c.error(W.message||"Error updating wishlist.",{position:"top-center"})}catch{c.error("Error updating wishlist.",{position:"top-center"})}},T=t=>{const o=[];for(let s=1;s<=5;s++)s<=t?o.push(e.jsx($,{color:"#ffc107"},s)):s-.5<=t?o.push(e.jsx(D,{color:"#ffc107"},s)):o.push(e.jsx(O,{color:"#ffc107"},s));return o},I=["All",...new Set(l.map(t=>t.category))],E=t=>{C(o=>t==="All"?[]:o.includes(t)?o.filter(s=>s!==t):[...o,t])},m=l.filter(t=>{const o=t.name.toLowerCase().includes(j.toLowerCase()||y.toLowerCase()),s=i.length===0||i.includes(t.category);return o&&s});return k?e.jsx("p",{children:"Loading..."}):d?e.jsxs("p",{children:["Error: ",d]}):e.jsxs("div",{className:r.container,children:[e.jsx("div",{className:r.filterBar,children:e.jsx("div",{className:r.categoryFilter,children:I.map(t=>e.jsx("button",{onClick:()=>E(t),className:`${r.categoryButton} ${i.includes(t)?r.selected:""}`,children:t},t))})}),e.jsx("div",{className:r.productList,children:m.length>0?m.map(t=>{var o;return e.jsxs("div",{className:r.productCard,children:[e.jsx(b,{to:`/products/${t._id}`,className:r.imageWrapper,children:e.jsx("img",{src:t.image,alt:t.name,className:r.productImage})}),e.jsxs("div",{className:r.productInfo,children:[e.jsx("h3",{className:r.productName,children:t.name}),e.jsxs("div",{className:r.productRating,children:[T(t.rating),e.jsxs("span",{children:["(",((o=t.rating)==null?void 0:o.toFixed(1))||"No Rating",")"]})]}),e.jsx("p",{className:r.productDescription,children:t.description}),e.jsxs("p",{className:r.productPrice,children:["$",t.price.toFixed(2)]}),e.jsxs("div",{className:r.buttonContainer,children:[e.jsx("button",{onClick:()=>B(t._id),className:r.addToCartBtn,children:"Add to Cart"}),e.jsx("button",{onClick:()=>N(t._id),className:r.addToWishlistBtn,children:h.includes(t._id)?e.jsx(A,{}):e.jsx(v,{})})]})]})]},t._id)}):e.jsx("p",{children:"No products found."})}),e.jsx(z,{})]})}export{_t as default};
