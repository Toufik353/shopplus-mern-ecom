import{r as c,j as e}from"./index-BhxEaC_k.js";import{B as h,Q as j}from"./ReactToastify-BodD9Uj_.js";const w="_orderHistoryContainer_1ffv3_1",N="_pageTitle_1ffv3_5",y="_ordersList_1ffv3_10",S="_orderCard_1ffv3_16",C="_trackingSection_1ffv3_23",k="_itemsSection_1ffv3_27",b="_addReviewButton_1ffv3_31",I="_reviewFormContainer_1ffv3_46",B="_submitReviewBtn_1ffv3_60",H="_error_1ffv3_73",O="_active_1ffv3_84",s={orderHistoryContainer:w,pageTitle:N,ordersList:y,orderCard:S,trackingSection:C,itemsSection:k,addReviewButton:b,reviewFormContainer:I,submitReviewBtn:B,error:H,active:O},E=()=>{const[d,m]=c.useState([]),[l,u]=c.useState(null);c.useEffect(()=>{p()},[]);const p=async()=>{const t=localStorage.getItem("authToken");if(!t){u("You must be logged in to view order history."),h.error("You must be logged in to view order history.");return}try{const r=await fetch("hhttps://shopplus-ecom-backend.onrender.com/order-history",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),n=await r.json();if(r.ok){const a=n.orders.filter((o,v,g)=>v===g.findIndex(x=>x._id===o._id)),i=["Processing","Shipped","Delivered","Pending"],_=a.map(o=>({...o,date:o.date?new Date(o.date).toLocaleDateString():"Invalid Date",totalAmount:o.totalAmount&&!isNaN(o.totalAmount)?o.totalAmount.toFixed(2):"0.00",status:i[Math.floor(Math.random()*i.length)]}));m(_)}else throw new Error(n.message||"Failed to fetch order history")}catch(r){u(r.message),h.error(`Error: ${r.message}`)}},f=t=>{switch(t){case"Processing":return s.processing;case"Shipped":return s.shipped;case"Delivered":return s.delivered;default:return s.pending}};return e.jsxs("div",{className:s.orderHistoryContainer,children:[e.jsx("h1",{className:s.pageTitle,children:"Order History"}),l&&e.jsx("p",{className:s.error,children:l}),d.length>0?e.jsx("div",{className:s.ordersList,children:d.map(t=>e.jsxs("div",{className:s.orderCard,children:[e.jsxs("h3",{children:["Order #",t._id]}),e.jsxs("div",{className:s.trackingSection,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"}),e.jsx("span",{className:f(t.status),children:t.status})]}),t.trackingNumber&&e.jsxs("p",{children:[e.jsx("strong",{children:"Tracking Number:"})," ",t.trackingNumber]})]}),e.jsxs("div",{className:s.itemsSection,children:[e.jsx("h4",{children:"Items:"}),e.jsx("ul",{children:t.items.map(r=>{var n,a,i;return e.jsxs("li",{children:[((n=r.productId)==null?void 0:n.name)||"Unnamed Product"," - ",r.quantity," x $",(a=r.productId)!=null&&a.price&&!isNaN(r.productId.price)?r.productId.price.toFixed(2):"0.00"]},((i=r.productId)==null?void 0:i._id)||Math.random())})})]})]},t._id))}):e.jsx("p",{children:"No orders found."}),e.jsx(j,{})]})};export{E as default};
