import{f as A,r as i,g as P,a as D,j as e,i as E,c as $,d as L,e as W}from"./index-BhxEaC_k.js";import{Q as H,B as n}from"./ReactToastify-BodD9Uj_.js";const z="_productDetail_12shs_1",O="_addReviewButton_12shs_11",J="_productName_12shs_30",q="_productPrice_12shs_34",Q="_productDescription_12shs_38",Y="_imageWrapper_12shs_43",G="_productImage_12shs_52",K="_thumbnailContainer_12shs_64",M="_thumbnail_12shs_64",U="_productInfo_12shs_83",V="_addToCartBtn_12shs_110",X="_reviewsSection_12shs_128",Z="_averageRating_12shs_143",ee="_reviewList_12shs_148",te="_reviewCard_12shs_154",se="_reviewHeader_12shs_161",re="_userAvatar_12shs_167",ae="_userName_12shs_173",oe="_reviewText_12shs_177",ie="_reviewForm_12shs_182",ne="_submitReviewBtn_12shs_195",ce="_reviewFormContainer_12shs_243",le="_active_12shs_252",de="_error_12shs_300",r={productDetail:z,addReviewButton:O,productName:J,productPrice:q,productDescription:Q,imageWrapper:Y,productImage:G,thumbnailContainer:K,thumbnail:M,productInfo:U,addToCartBtn:V,reviewsSection:X,averageRating:Z,reviewList:ee,reviewCard:te,reviewHeader:se,userAvatar:re,userName:ae,reviewText:oe,reviewForm:ie,submitReviewBtn:ne,reviewFormContainer:ce,active:le,error:de};function me(){var b,N;const{productId:c}=A(),[t,S]=i.useState(null),[C,p]=i.useState(!0),[v,R]=i.useState(null),[d,w]=i.useState([]),[u,g]=i.useState(0),[h,_]=i.useState(""),[m,x]=i.useState(!1),y=!!localStorage.getItem("authToken");P(s=>s.cart.cartCount);const k=D(),I=async()=>{const s=localStorage.getItem("authToken");try{p(!0);const a=await fetch(`https://shopplus-ecom-backend.onrender.com/products/${c}`,{headers:{Authorization:`Bearer ${s}`}});if(!a.ok)throw new Error("Failed to fetch product details");const o=await a.json();S(o.product),w(o.product.reviews||[])}catch(a){R(a.message)}finally{p(!1)}},f=async()=>{const s=localStorage.getItem("authToken");try{const a=await fetch(`https://shopplus-ecom-backend.onrender.com/reviews/${c}`,{headers:{Authorization:`Bearer ${s}`}});if(!a.ok)throw new Error("Failed to fetch reviews");const o=await a.json();w(o.filter(l=>l.productId.toString()===c))}catch{}};i.useEffect(()=>{I(),f()},[c]);const F=async s=>{const a=localStorage.getItem("authToken"),o=localStorage.getItem("userId"),l=1;try{if(!(await fetch("https://shopplus-ecom-backend.onrender.com/cart",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({userId:o,productId:s,quantity:l})})).ok)throw new Error("Failed to add product to cart");k(E()),n.success("Successfully added to the cart!",{position:"top-center",autoClose:2e3})}catch{n.error("Error adding to cart",{position:"top-center"})}},T=async s=>{s.preventDefault();const a=localStorage.getItem("authToken"),o=localStorage.getItem("userId");if(!o||!a){n.error("You need to be logged in to submit a review");return}if(u<1||u>5){n.error("Please provide a rating between 1 and 5.");return}if(!h.trim()){n.error("Please write a review before submitting.");return}try{if(!(await fetch("https://shopplus-ecom-backend.onrender.com/reviews",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({productId:c,rating:u,review:h,userId:o})})).ok)throw new Error("Failed to submit review");f(),g(0),_(""),x(!1),n.success("Review submitted successfully!",{position:"top-center"})}catch{n.error("Failed to submit review")}},j=s=>{const a=[];for(let o=1;o<=5;o++)o<=s?a.push(e.jsx($,{color:"#ffc107"},o)):o-.5<=s?a.push(e.jsx(L,{color:"#ffc107"},o)):a.push(e.jsx(W,{color:"#ffc107"},o));return a};return C?e.jsx("p",{children:"Loading..."}):v?e.jsxs("p",{children:["Error: ",v]}):e.jsxs("div",{className:r.productDetail,children:[e.jsxs("div",{className:r.imageWrapper,children:[e.jsx("img",{src:t==null?void 0:t.image,alt:t==null?void 0:t.name,className:r.productImage}),e.jsx("div",{className:r.thumbnailContainer,children:(b=t==null?void 0:t.thumbnails)==null?void 0:b.map((s,a)=>e.jsx("img",{src:s,alt:`Thumbnail ${a+1}`,className:r.thumbnail},a))})]}),e.jsxs("div",{className:r.productInfo,children:[e.jsx("h1",{className:r.productName,children:t==null?void 0:t.name}),e.jsx("p",{className:r.productDescription,children:t==null?void 0:t.description}),e.jsxs("p",{className:r.productPrice,children:["$",t==null?void 0:t.price]}),e.jsxs("p",{className:r.productCategory,children:["Category: ",t==null?void 0:t.category]}),e.jsxs("p",{className:r.productStock,children:["In Stock: ",t==null?void 0:t.stock]}),e.jsxs("div",{className:r.productRating,children:[j(t==null?void 0:t.rating),e.jsxs("span",{children:["(",((N=t==null?void 0:t.rating)==null?void 0:N.toFixed(1))||"No Rating",")"]})]}),e.jsx("button",{className:`${r.addToCartBtn} ${r.btn}`,onClick:()=>F(t._id),children:"Add to Cart"})]}),e.jsxs("div",{className:r.reviewsSection,children:[e.jsx("h2",{children:"Customer Reviews"}),d.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:r.averageRating,children:["Average Rating:"," ",(d.reduce((s,a)=>s+a.rating,0)/d.length).toFixed(1)," ","/ 5"]}),e.jsx("div",{className:r.reviewList,children:d.map(s=>e.jsxs("div",{className:r.reviewCard,children:[e.jsxs("div",{className:r.reviewHeader,children:[e.jsx("img",{src:s.userAvatar||"/default-avatar.png",alt:s.user,className:r.userAvatar}),e.jsx("span",{className:r.userName,children:s.user}),e.jsx("span",{className:r.reviewRating,children:j(s.rating)})]}),e.jsx("p",{className:r.reviewText,children:s.review})]},s._id))})]}):e.jsx("p",{children:"No reviews yet. Be the first to review this product!"}),y?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:r.addReviewButton,onClick:()=>x(!m),children:m?"Cancel":"Write a Review"}),m&&e.jsxs("form",{className:r.reviewForm,onSubmit:T,children:[e.jsx("textarea",{value:h,onChange:s=>_(s.target.value),placeholder:"Write your review here..."}),e.jsxs("div",{children:[e.jsx("label",{children:"Rating:"}),e.jsx("input",{type:"number",min:"1",max:"5",value:u,onChange:s=>g(Number(s.target.value))})]}),e.jsx("button",{type:"submit",className:r.submitReviewBtn,children:"Submit Review"})]})]}):e.jsxs("p",{children:["Please"," ",e.jsx("a",{href:"/login",className:r.loginLink,children:"log in"})," ","to write a review."]})]}),e.jsx(H,{})]})}export{me as default};
