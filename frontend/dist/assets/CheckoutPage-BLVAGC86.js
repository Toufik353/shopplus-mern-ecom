import{l as ye,R as c,h as ve,r as w,j as a}from"./index-BhxEaC_k.js";import{Q as ge,B as M}from"./ReactToastify-BodD9Uj_.js";var Y={exports:{}},z,G;function Ce(){if(G)return z;G=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return z=r,z}var J,X;function Se(){if(X)return J;X=1;var r=Ce();function e(){}function t(){}return t.resetWarningCache=e,J=function(){function n(l,y,s,x,v,g){if(g!==r){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}n.isRequired=n;function i(){return n}var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:i,element:n,elementType:n,instanceOf:i,node:n,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return o.PropTypes=o,o},J}var Z;function xe(){return Z||(Z=1,Y.exports=Se()()),Y.exports}var be=xe();const u=ye(be);function ee(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function te(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ee(Object(t),!0).forEach(function(n){ae(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ee(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function D(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?D=function(e){return typeof e}:D=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(r)}function ae(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ie(r,e){return _e(r)||Ee(r,e)||je(r,e)||ke()}function _e(r){if(Array.isArray(r))return r}function Ee(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],i=!0,o=!1,l,y;try{for(t=t.call(r);!(i=(l=t.next()).done)&&(n.push(l.value),!(e&&n.length===e));i=!0);}catch(s){o=!0,y=s}finally{try{!i&&t.return!=null&&t.return()}finally{if(o)throw y}}return n}}function je(r,e){if(r){if(typeof r=="string")return re(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return re(r,e)}}function re(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function ke(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _=function(e,t,n){var i=!!n,o=c.useRef(n);c.useEffect(function(){o.current=n},[n]),c.useEffect(function(){if(!i||!e)return function(){};var l=function(){o.current&&o.current.apply(o,arguments)};return e.on(t,l),function(){e.off(t,l)}},[i,t,e,o])},K=function(e){var t=c.useRef(e);return c.useEffect(function(){t.current=e},[e]),t.current},R=function(e){return e!==null&&D(e)==="object"},Pe=function(e){return R(e)&&typeof e.then=="function"},Oe=function(e){return R(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ne="[object Object]",Te=function r(e,t){if(!R(e)||!R(t))return e===t;var n=Array.isArray(e),i=Array.isArray(t);if(n!==i)return!1;var o=Object.prototype.toString.call(e)===ne,l=Object.prototype.toString.call(t)===ne;if(o!==l)return!1;if(!o&&!n)return e===t;var y=Object.keys(e),s=Object.keys(t);if(y.length!==s.length)return!1;for(var x={},v=0;v<y.length;v+=1)x[y[v]]=!0;for(var g=0;g<s.length;g+=1)x[s[g]]=!0;var p=Object.keys(x);if(p.length!==y.length)return!1;var k=e,C=t,j=function(b){return r(k[b],C[b])};return p.every(j)},ce=function(e,t,n){return R(e)?Object.keys(e).reduce(function(i,o){var l=!R(t)||!Te(e[o],t[o]);return n.includes(o)?(l&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),i):l?te(te({},i||{}),{},ae({},o,e[o])):i},null):null},ue="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",se=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ue;if(e===null||Oe(e))return e;throw new Error(t)},Ae=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ue;if(Pe(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(i){return se(i,t)})};var n=se(e,t);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},Re=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"2.9.0"}),e.registerAppInfo({name:"react-stripe-js",version:"2.9.0",url:"https://stripe.com/docs/stripe-js/react"}))},$=c.createContext(null);$.displayName="ElementsContext";var le=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},Ne=function(e){var t=e.stripe,n=e.options,i=e.children,o=c.useMemo(function(){return Ae(t)},[t]),l=c.useState(function(){return{stripe:o.tag==="sync"?o.stripe:null,elements:o.tag==="sync"?o.stripe.elements(n):null}}),y=ie(l,2),s=y[0],x=y[1];c.useEffect(function(){var p=!0,k=function(j){x(function(d){return d.stripe?d:{stripe:j,elements:j.elements(n)}})};return o.tag==="async"&&!s.stripe?o.stripePromise.then(function(C){C&&p&&k(C)}):o.tag==="sync"&&!s.stripe&&k(o.stripe),function(){p=!1}},[o,s,n]);var v=K(t);c.useEffect(function(){v!==null&&v!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[v,t]);var g=K(n);return c.useEffect(function(){if(s.elements){var p=ce(n,g,["clientSecret","fonts"]);p&&s.elements.update(p)}},[n,g,s.elements]),c.useEffect(function(){Re(s.stripe)},[s.stripe]),c.createElement($.Provider,{value:s},i)};Ne.propTypes={stripe:u.any,options:u.object};var we=function(e){var t=c.useContext($);return le(t,e)},Ie=function(){var e=we("calls useElements()"),t=e.elements;return t};u.func.isRequired;var pe=c.createContext(null);pe.displayName="CheckoutSdkContext";var Be=function(e,t){if(!e)throw new Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CheckoutProvider> provider."));return e},We=c.createContext(null);We.displayName="CheckoutContext";u.any,u.shape({clientSecret:u.string.isRequired,elementsOptions:u.object}).isRequired;var H=function(e){var t=c.useContext(pe),n=c.useContext($);if(t&&n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t?Be(t,e):le(n,e)},De=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},f=function(e,t){var n="".concat(De(e),"Element"),i=function(s){var x=s.id,v=s.className,g=s.options,p=g===void 0?{}:g,k=s.onBlur,C=s.onFocus,j=s.onReady,d=s.onChange,b=s.onEscape,O=s.onClick,A=s.onLoadError,T=s.onLoaderStart,F=s.onNetworksChange,N=s.onConfirm,L=s.onCancel,de=s.onShippingAddressChange,fe=s.onShippingRateChange,I=H("mounts <".concat(n,">")),B="elements"in I?I.elements:null,W="checkoutSdk"in I?I.checkoutSdk:null,me=c.useState(null),V=ie(me,2),S=V[0],he=V[1],P=c.useRef(null),q=c.useRef(null);_(S,"blur",k),_(S,"focus",C),_(S,"escape",b),_(S,"click",O),_(S,"loaderror",A),_(S,"loaderstart",T),_(S,"networkschange",F),_(S,"confirm",N),_(S,"cancel",L),_(S,"shippingaddresschange",de),_(S,"shippingratechange",fe),_(S,"change",d);var U;j&&(e==="expressCheckout"?U=j:U=function(){j(S)}),_(S,"ready",U),c.useLayoutEffect(function(){if(P.current===null&&q.current!==null&&(B||W)){var E=null;W?E=W.createElement(e,p):B&&(E=B.create(e,p)),P.current=E,he(E),E&&E.mount(q.current)}},[B,W,p]);var Q=K(p);return c.useEffect(function(){if(P.current){var E=ce(p,Q,["paymentRequest"]);E&&"update"in P.current&&P.current.update(E)}},[p,Q]),c.useLayoutEffect(function(){return function(){if(P.current&&typeof P.current.destroy=="function")try{P.current.destroy(),P.current=null}catch{}}},[]),c.createElement("div",{id:x,className:v,ref:q})},o=function(s){H("mounts <".concat(n,">"));var x=s.id,v=s.className;return c.createElement("div",{id:x,className:v})},l=t?o:i;return l.propTypes={id:u.string,className:u.string,onChange:u.func,onBlur:u.func,onFocus:u.func,onReady:u.func,onEscape:u.func,onClick:u.func,onLoadError:u.func,onLoaderStart:u.func,onNetworksChange:u.func,onConfirm:u.func,onCancel:u.func,onShippingAddressChange:u.func,onShippingRateChange:u.func,options:u.object},l.displayName=n,l.__elementType=e,l},m=typeof window>"u",$e=c.createContext(null);$e.displayName="EmbeddedCheckoutProviderContext";var Fe=function(){var e=H("calls useStripe()"),t=e.stripe;return t};f("auBankAccount",m);var oe=f("card",m);f("cardNumber",m);f("cardExpiry",m);f("cardCvc",m);f("fpxBank",m);f("iban",m);f("idealBank",m);f("p24Bank",m);f("epsBank",m);f("payment",m);f("expressCheckout",m);f("currencySelector",m);f("paymentRequestButton",m);f("linkAuthentication",m);f("address",m);f("shippingAddress",m);f("paymentMethodMessaging",m);f("affirmMessage",m);f("afterpayClearpayMessage",m);const Le="_checkoutContainer_1t056_1",qe="_title_1t056_11",Ue="_formWrapper_1t056_19",Me="_form_1t056_19",Ye="_sectionTitle_1t056_28",ze="_addressSection_1t056_35",Je="_addressList_1t056_39",Ke="_addressItem_1t056_49",He="_selected_1t056_62",Ve="_addressActions_1t056_67",Qe="_setDefaultButton_1t056_74",Ge="_paymentSection_1t056_88",Xe="_cardInput_1t056_92",Ze="_cardElement_1t056_96",et="_orderSummary_1t056_102",tt="_summaryTable_1t056_108",rt="_totalRow_1t056_119",nt="_errorAlert_1t056_126",st="_submitButton_1t056_133",h={checkoutContainer:Le,title:qe,formWrapper:Ue,form:Me,sectionTitle:Ye,addressSection:ze,addressList:Je,addressItem:Ke,selected:He,addressActions:Ve,setDefaultButton:Qe,paymentSection:Ge,cardInput:Xe,cardElement:Ze,orderSummary:et,summaryTable:tt,totalRow:rt,errorAlert:nt,submitButton:st},ot=({clientSecret:r,cart:e,onPaymentSuccess:t})=>{const n=Fe(),i=Ie(),o=ve(),[l,y]=w.useState([]),[s,x]=w.useState(null),[v,g]=w.useState(null),[p,k]=w.useState(!1),C=()=>e.items.reduce((d,b)=>{var T;const O=((T=b.productId)==null?void 0:T.price)||0,A=b.quantity||0;return d+O*A},0);w.useEffect(()=>{(async()=>{const b=localStorage.getItem("authToken");try{const A=await(await fetch("https://shopplus-ecom-backend.onrender.com/addaddress",{headers:{Authorization:`Bearer ${b}`}})).json();if(console.log("Fetched Addresses:",A),Array.isArray(A)){const T=A.sort((N,L)=>L.isDefault-N.isDefault);y(T);const F=T.find(N=>N.isDefault)||T[0];x(F)}else throw new Error("Invalid address data")}catch(O){console.error("Error fetching addresses:",O),M.error("Failed to fetch addresses",{position:"top-center",autoClose:2e3,hideProgressBar:!0,theme:"colored"})}})()},[]);const j=async d=>{if(d.preventDefault(),!n||!i){g("Payment processing is unavailable. Please try again.");return}if(!s){g("Please select a delivery address.");return}k(!0);const{error:b}=await n.confirmCardPayment(r,{payment_method:{card:i.getElement(oe)}});if(b)g(b.message),M.error(b.message,{position:"top-center",autoClose:2e3,hideProgressBar:!0,theme:"colored"});else{k(!1),M.success("Payment successful!",{position:"top-center",autoClose:2e3,hideProgressBar:!0,theme:"colored"});const O={items:e.items,total:C()+C()*.2+15,shippingAddress:s};localStorage.setItem("orderData",JSON.stringify(O)),localStorage.removeItem("cart"),t(),o("/order-confirmation")}};return a.jsxs("div",{className:h.checkoutContainer,children:[a.jsx("h1",{className:h.title,children:"Secure Checkout"}),a.jsx("div",{className:h.formWrapper,children:a.jsxs("form",{onSubmit:j,className:h.form,children:[a.jsxs("div",{className:h.addressSection,children:[a.jsx("h2",{className:h.sectionTitle,children:"Select Delivery Address"}),l.length===0?a.jsx("p",{children:"No addresses found. Please add one in your profile."}):a.jsx(a.Fragment,{children:a.jsx("div",{className:h.addressList,children:l.map(d=>a.jsx("div",{className:`${h.addressItem} ${(s==null?void 0:s._id)===d._id?h.selected:""}`,onClick:()=>x(d),children:a.jsx("p",{children:`${d.fullName}, ${d.flat}, ${d.area}, ${d.city}, ${d.state}, ${d.pincode}`})},d._id))})})]}),a.jsxs("div",{className:h.paymentSection,children:[a.jsx("h2",{className:h.sectionTitle,children:"Payment Information"}),a.jsxs("div",{className:h.cardInput,children:[a.jsx("label",{htmlFor:"card-element",children:"Credit or Debit Card"}),a.jsx(oe,{id:"card-element",className:h.cardElement})]})]}),a.jsxs("div",{className:h.orderSummary,children:[a.jsx("h2",{className:h.sectionTitle,children:"Order Summary"}),a.jsx("table",{className:h.summaryTable,children:a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{children:"Subtotal:"}),a.jsxs("td",{children:["$",C().toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{children:"Tax (20%):"}),a.jsxs("td",{children:["$",(C()*.2).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{children:"Shipping:"}),a.jsx("td",{children:"$15.00"})]}),a.jsxs("tr",{className:h.totalRow,children:[a.jsx("td",{children:"Total:"}),a.jsxs("td",{children:["$",(C()+C()*.2+15).toFixed(2)]})]})]})})]}),v&&a.jsx("div",{className:h.errorAlert,children:v}),a.jsx("button",{disabled:p,type:"submit",className:h.submitButton,children:p?"Processing...":"Complete Purchase"})]})}),a.jsx(ge,{})]})},ct=Object.freeze(Object.defineProperty({__proto__:null,default:ot},Symbol.toStringTag,{value:"Module"}));export{ot as C,Ne as E,ct as a};
